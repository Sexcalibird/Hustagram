{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"../axios/axios\";\nconst initialState = {\n  accessToken: null,\n  error: null\n};\nexport const signIn = createAsyncThunk('auth/signIn', async (_ref, _ref2) => {\n  let {\n    email,\n    pwd\n  } = _ref;\n  let {\n    rejectWithValue\n  } = _ref2;\n  try {\n    const response = await axios.post('/auth', {\n      email,\n      pwd\n    });\n    return response.data.accessToken;\n  } catch (err) {\n    var _err$response, _err$response2;\n    if (!(err !== null && err !== void 0 && err.response)) {\n      return rejectWithValue('No Server Response');\n    } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n      return rejectWithValue('Missing Email or Password');\n    } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n      return rejectWithValue('Unauthorized');\n    } else {\n      return rejectWithValue('Login Failed');\n    }\n  }\n});\nexport const signOut = createAsyncThunk('auth/signOut', async () => {\n  try {\n    const response = await axios.get('/logout', {\n      withCredentials: true\n    });\n  } catch (err) {\n    console.error(err);\n  }\n});\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    refreshToken: (state, action) => {\n      state.accessToken = action.payload;\n    },\n    logOut: (state, action) => {\n      state.accessToken = null;\n      return async () => {\n        try {\n          const response = await axios('/logout', {\n            withCredentials: true\n          });\n        } catch (err) {\n          console.error(err);\n        }\n      };\n    }\n  },\n  extraReducers(builder) {\n    builder.addCase(signIn.fulfilled, (state, action) => {\n      state.accessToken = action.payload;\n      state.error = null;\n    }).addCase(signIn.rejected, (state, action) => {\n      state.error = action.payload;\n    }).addCase(signOut.fulfilled, () => {\n      return {\n        ...initialState\n      };\n    });\n  }\n});\nexport const getAuth = state => state.auth.accessToken;\nexport const getError = state => state.auth.error;\nexport const {\n  refreshToken,\n  logOut\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","initialState","accessToken","error","signIn","email","pwd","rejectWithValue","response","post","data","err","status","signOut","get","withCredentials","console","authSlice","name","reducers","refreshToken","state","action","payload","logOut","extraReducers","builder","addCase","fulfilled","rejected","getAuth","auth","getError","actions","reducer"],"sources":["C:/Users/ADMIN/IdeaProjects/datn/client/src/redux/authSlice.js"],"sourcesContent":["import {createSlice, createAsyncThunk} from \"@reduxjs/toolkit\";\r\nimport axios from \"../axios/axios\";\r\n\r\nconst initialState = {\r\n    accessToken: null,\r\n    error : null\r\n}\r\n\r\nexport const signIn = createAsyncThunk('auth/signIn',async ({email, pwd}, {rejectWithValue}) => {\r\n    try {\r\n        const response = await axios.post('/auth', {email, pwd})\r\n        return response.data.accessToken\r\n    } catch (err) {\r\n        if (!err?.response) {\r\n            return rejectWithValue('No Server Response');\r\n        } else if (err.response?.status === 400) {\r\n            return rejectWithValue('Missing Email or Password');\r\n        } else if (err.response?.status === 401) {\r\n            return rejectWithValue('Unauthorized')\r\n        } else {\r\n            return rejectWithValue('Login Failed')\r\n        }\r\n    }\r\n})\r\n\r\nexport const signOut = createAsyncThunk('auth/signOut',async () => {\r\n    try {\r\n        const response = await axios.get('/logout', {\r\n            withCredentials: true\r\n        });\r\n    } catch (err) {\r\n        console.error(err);\r\n    }\r\n})\r\n\r\nconst authSlice = createSlice({\r\n    name: 'auth',\r\n    initialState,\r\n    reducers: {\r\n        refreshToken: (state, action) => {\r\n            state.accessToken = action.payload\r\n        },\r\n        logOut: (state, action) => {\r\n            state.accessToken = null\r\n            return async () => {\r\n                try {\r\n                    const response = await axios('/logout', {\r\n                        withCredentials: true\r\n                    });\r\n                } catch (err) {\r\n                    console.error(err);\r\n                }\r\n            }\r\n        }\r\n    },\r\n    extraReducers(builder){\r\n        builder\r\n            .addCase(signIn.fulfilled,(state,action) => {\r\n                state.accessToken = action.payload\r\n                state.error = null\r\n            })\r\n            .addCase(signIn.rejected, (state, action) => {\r\n                state.error = action.payload\r\n            })\r\n            .addCase(signOut.fulfilled,() => {\r\n                return { ...initialState }\r\n            })\r\n    }\r\n})\r\n\r\nexport const getAuth = (state) => state.auth.accessToken\r\nexport const getError = (state) => state.auth.error\r\nexport const {refreshToken, logOut} = authSlice.actions\r\nexport default authSlice.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}