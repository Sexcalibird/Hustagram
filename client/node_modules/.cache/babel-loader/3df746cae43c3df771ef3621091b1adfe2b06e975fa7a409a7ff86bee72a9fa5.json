{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"../axios/axios\";\nimport { followUser, savePost } from \"./usersSlice\";\nconst initialState = {\n  auth: null,\n  accessToken: null,\n  error: null\n};\nexport const signIn = createAsyncThunk('auth/signIn', async (_ref, _ref2) => {\n  let {\n    email,\n    pwd\n  } = _ref;\n  let {\n    rejectWithValue\n  } = _ref2;\n  try {\n    const response = await axios.post('/auth', {\n      email,\n      pwd\n    }, {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      withCredentials: true\n    });\n    return response.data;\n  } catch (err) {\n    var _err$response, _err$response2;\n    if (!(err !== null && err !== void 0 && err.response)) {\n      return rejectWithValue('No Server Response');\n    } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n      return rejectWithValue('Missing Email or Password');\n    } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n      return rejectWithValue('Unauthorized');\n    } else {\n      return rejectWithValue('Login Failed');\n    }\n  }\n});\nexport const signOut = createAsyncThunk('auth/signOut', async () => {\n  try {\n    const response = await axios.get('/logout', {\n      withCredentials: true\n    });\n    return response.status;\n  } catch (err) {\n    console.error(err);\n  }\n});\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    refreshToken: (state, action) => {\n      state.accessToken = action.payload;\n    }\n  },\n  extraReducers(builder) {\n    builder.addCase(signIn.fulfilled, (state, action) => {\n      state.auth = action.payload.auth;\n      state.accessToken = action.payload.accessToken;\n      state.error = null;\n    }).addCase(signIn.rejected, (state, action) => {\n      state.error = action.payload;\n    }).addCase(signOut.fulfilled, () => {\n      return {\n        ...initialState\n      };\n    }).addCase(followUser.fulfilled, (state, action) => {\n      state.auth.followings = action.payload.updatedUser.followings;\n    }).addCase(savePost.fulfilled, (state, action) => {\n      const {\n        saved\n      } = action.payload;\n      state.auth.saved = saved;\n    });\n  }\n});\nexport const getAuth = state => state.auth.auth;\nexport const getToken = state => state.auth.accessToken;\nexport const getError = state => state.auth.error;\nexport const {\n  refreshToken\n} = authSlice.actions;\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","followUser","savePost","initialState","auth","accessToken","error","signIn","email","pwd","rejectWithValue","response","post","headers","withCredentials","data","err","status","signOut","get","console","authSlice","name","reducers","refreshToken","state","action","payload","extraReducers","builder","addCase","fulfilled","rejected","followings","updatedUser","saved","getAuth","getToken","getError","actions","reducer"],"sources":["C:/Users/ADMIN/IdeaProjects/datn/client/src/redux/authSlice.js"],"sourcesContent":["import {createSlice, createAsyncThunk} from \"@reduxjs/toolkit\";\r\nimport axios from \"../axios/axios\";\r\nimport {followUser, savePost} from \"./usersSlice\";\r\n\r\nconst initialState = {\r\n    auth: null,\r\n    accessToken: null,\r\n    error : null\r\n}\r\n\r\nexport const signIn = createAsyncThunk('auth/signIn',async ({email, pwd}, {rejectWithValue}) => {\r\n    try {\r\n        const response = await axios.post('/auth', {email, pwd}, {\r\n            headers: { 'Content-Type': 'application/json' },\r\n            withCredentials: true\r\n        })\r\n        return response.data\r\n    } catch (err) {\r\n        if (!err?.response) {\r\n            return rejectWithValue('No Server Response');\r\n        } else if (err.response?.status === 400) {\r\n            return rejectWithValue('Missing Email or Password');\r\n        } else if (err.response?.status === 401) {\r\n            return rejectWithValue('Unauthorized')\r\n        } else {\r\n            return rejectWithValue('Login Failed')\r\n        }\r\n    }\r\n})\r\n\r\nexport const signOut = createAsyncThunk('auth/signOut',async () => {\r\n    try {\r\n        const response = await axios.get('/logout', {\r\n            withCredentials: true\r\n        });\r\n        return response.status\r\n    } catch (err) {\r\n        console.error(err);\r\n    }\r\n})\r\n\r\n\r\n\r\nconst authSlice = createSlice({\r\n    name: 'auth',\r\n    initialState,\r\n    reducers: {\r\n        refreshToken: (state, action) => {\r\n            state.accessToken = action.payload\r\n        },\r\n    },\r\n    extraReducers(builder){\r\n        builder\r\n            .addCase(signIn.fulfilled,(state,action) => {\r\n                state.auth = action.payload.auth\r\n                state.accessToken = action.payload.accessToken\r\n                state.error = null\r\n            })\r\n            .addCase(signIn.rejected, (state, action) => {\r\n                state.error = action.payload\r\n            })\r\n            .addCase(signOut.fulfilled,() => {\r\n                return { ...initialState }\r\n            })\r\n\r\n            .addCase(followUser.fulfilled, (state, action) => {\r\n                state.auth.followings = action.payload.updatedUser.followings\r\n            })\r\n\r\n            .addCase(savePost.fulfilled, (state, action) => {\r\n                const {saved} = action.payload\r\n                state.auth.saved = saved\r\n            })\r\n    }\r\n})\r\n\r\nexport const getAuth = (state) => state.auth.auth\r\nexport const getToken = (state) => state.auth.accessToken\r\nexport const getError = (state) => state.auth.error\r\nexport const {refreshToken} = authSlice.actions\r\nexport default authSlice.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}